2019-06-19 00:22:51,924  鹏程@CMBC 说: 
欢迎新来的朋友~方便做个简单自我介绍，再把群名片改下名字@公司~然后看下群公告，谢谢！ @船长
2019-06-19 00:23:48,695  船长 说: 
好的😄
2019-06-19 00:24:31,578  登进@gm 说: 
大家好，我是Java开发，现在是起步阶段，请大家多多关照😄
2019-06-19 00:31:09,340  鹏程@CMBC 说: 
欢迎~
2019-06-19 00:31:52,605  登进@gm 说: 
😂😂，可能这个点，大家都在地铁上吧[捂脸]
2019-06-19 00:32:58,346  周淼@育儿网 说: 
You are right, gm is?
2019-06-19 00:33:23,051  登进@gm 说: 
国美
2019-06-19 00:33:57,583  周淼@育儿网 说: 
I thought it was game master
2019-06-19 00:36:20,138  登进@gm 说: 
😂，no game 
2019-06-19 02:58:52,868  鹏程@CMBC 分享链接:
 #每日分享 「链接」 https://mp.weixin.qq.com/s?__biz=MzU0MzQ5MDA0Mw==&amp;amp;mid=2247485921&amp;amp;idx=1&amp;amp;sn=de4e81bfba0ea8e1eb239bfa8bb40ae1&amp;amp;chksm=fb0be375cc7c6a63b72b62c955a4c2882cfa9ddb5b7d59316e7e8e3f11e993b3d60b46f0557f&amp;amp;xtrack=1&amp;amp;scene=90&amp;amp;subscene=93&amp;amp;sessionid=1560912996&amp;amp;clic
https://t.zsxq.com/fYFeaa2
2019-06-19 05:54:35,335  HQ@TAL 说: 
redisTemplate doInRedis 能保证原子性吗？
2019-06-19 05:54:43,214  HQ@TAL 说: 
看源码里也没有将，哪位大哥有研究呢？
2019-06-19 12:08:10,041  赵梅@上海七牛云 说: 
 昨天说的问题，有结论了
2019-06-19 12:09:22,322  赵梅@上海七牛云 说: 
部署了两个集群
2019-06-19 12:09:34,995  赵梅@上海七牛云 说: 
两个集群本应该是完全独立的
2019-06-19 12:09:47,895  赵梅@上海七牛云 说: 
一个服务竟然访问了两个集群
2019-06-19 12:11:18,939  赵梅@上海七牛云 说: 
redirected to local 127.0.0.1
2019-06-19 12:11:34,637  鹏程@CMBC 说: 
那个问题当时都没敢吱声。。。
2019-06-19 12:11:40,499  赵梅@上海七牛云 说: 
这个行为导致了访问2个集群
2019-06-19 12:11:57,524  白馨@陌陌 说: 
[皱眉]
2019-06-19 12:11:59,228  白馨@陌陌 说: 
可以的
2019-06-19 12:12:32,950  赵梅@上海七牛云 说: 
这个坑踩的，真有点
2019-06-19 12:22:54,413  白馨@陌陌 说: 
go客户端写的有问题？
2019-06-19 12:26:41,672  赵梅@上海七牛云 说: 
，在A，B两个机房部署了独立的两个rediscluster
2019-06-19 12:27:11,449  赵梅@上海七牛云 说: 
有个业务A机房的服务要访问B机房的集群，配置也只写了B机房的集群地址
2019-06-19 12:27:23,811  赵梅@上海七牛云 说: 
发现业务却访问了2个集群
2019-06-19 12:28:14,461  gukf@牛栏 说: 
集群建的有问题?
2019-06-19 12:28:17,800  赵梅@上海七牛云 说: 
这个业务所在的机器上恰巧部署了A集群的redis
2019-06-19 12:28:24,035  赵梅@上海七牛云 说: 
Bind 0.0.0.0
2019-06-19 12:28:52,763  赵梅@上海七牛云 说: 
集群本身没有问题，也没有混乱
2019-06-19 12:29:17,458  赵梅@上海七牛云 说: 
是bind写的不对
2019-06-19 12:30:44,049  赵梅@上海七牛云 说: 
因为这台业务服务机器上有redis,就redirect to 127.0.0.0
2019-06-19 12:30:57,973  赵梅@上海七牛云 说: 
因为这台业务服务机器上有redis,就redirect to 127.0.0.1
2019-06-19 12:33:04,831  gukf@牛栏 说: 
bind 0.0.0.0也没问题啊
2019-06-19 12:38:44,203  赵梅@上海七牛云 说: 
一个get
2019-06-19 12:38:44,520  stuart@improbable 说: 
那是redis的bug吧
2019-06-19 12:38:45,411  赵梅@上海七牛云 说: 
看这张图
2019-06-19 12:38:50,688  赵梅@上海七牛云 说: 
访问了127和10.29
2019-06-19 12:41:47,086  赵梅@上海七牛云 说: 
127的那个是本地的，不是我想访问的地址
2019-06-19 12:44:19,931  邓伟@jit 说: 
你说的有删除日志，是fo客户端打印的？
2019-06-19 12:44:56,619  邓伟@jit 说: 
那就是你日志打印有问题，迷惑了你
2019-06-19 12:45:52,853  赵梅@上海七牛云 说: 
客户端打印要去删除的key信息，并没有打印对应的host
2019-06-19 12:46:26,872  赵梅@上海七牛云 说: 
一开始排查的思路也不对，应该先看业务链接的redis对不对，而不是看代码是不是有bug
2019-06-19 12:46:41,288  赵梅@上海七牛云 说: 
失误
2019-06-19 12:47:44,788  赵梅@上海七牛云 说: 
建议bind 0.0.0.0不要使用，避免这类问题
2019-06-19 12:49:13,587  邓伟@jit 说: 
你这个不是根本解决方法
2019-06-19 12:50:57,054  赵梅@上海七牛云 说: 
现在改为bind在内网IP上
2019-06-19 12:50:57,350  赵梅@上海七牛云 说: 
有何建议
2019-06-19 12:51:38,554  邓伟@jit 说: 
设置acl
2019-06-19 12:51:52,277  邓伟@jit 说: 
异常访问报警，可以提示业务失败
2019-06-19 12:53:34,366  邓伟@jit 说: 
你甚至可以基于linux的iptable
2019-06-19 12:53:42,116  邓伟@jit 说: 
做些文章
2019-06-19 12:57:19,382  赵梅@上海七牛云 说: 
利用redisbind的限制访问能力，bind在固定IP，如果客户端特意访问这个IP，是不是可以接受。依赖外部措施保证，难免业务有变更，会不会把运维复杂了，集群如果很大，感觉这个维护复杂
2019-06-19 12:58:58,487  邓伟@jit 说: 
定义好协议就好了
2019-06-19 12:58:58,807  邓伟@jit 说: 
有些东西写到业务里，反而更复杂
2019-06-19 13:00:48,246  赵梅@上海七牛云 说: 
这种控制是不应该在业务上
2019-06-19 13:01:38,310  赵梅@上海七牛云 说: 
现在问题是访问了不在目标cluster中的节点
2019-06-19 13:03:01,785  赵梅@上海七牛云 说: 
访问是优先redirect to local 
2019-06-19 13:03:02,119  邓伟@jit 说: 
这就是越界了呀，后面会引发很多与其关联的问题呀
2019-06-19 13:03:02,499  邓伟@jit 说: 
得不尝失
2019-06-19 13:04:15,760  邓伟@jit 说: 
redirect前先确认对方的什么
2019-06-19 13:04:24,698  邓伟@jit 说: 
身份
2019-06-19 13:04:59,225  赵梅@上海七牛云 说: 
redis-cli 没有这么做呀，没有确认集群信息
2019-06-19 13:05:15,306  鹏程@CMBC 说: 
健身中看了下大家的讨论，说真的我没太明白引入iptables的强理由..
2019-06-19 13:06:13,677  赵梅@上海七牛云 说: 
个人觉得复杂化了，bind的限制足矣
2019-06-19 13:24:08,626  赵梅@上海七牛云 说: 
这个越界访问有告警的思路有参考。谁都不能保证配置不写错，是不是[捂脸]
2019-06-19 23:09:37,754  鹏程@CMBC 分享链接:
 #每日分享 「链接」 走进KeyDB - 阿里云栖社区 - SegmentFault 思否
https://t.zsxq.com/6QBAuNf
