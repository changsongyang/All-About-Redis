2019-06-13 18:19:19,878  杨力@喜马拉雅 说: 
hi，各位大佬有没有人遇到过codis-proxy向redis请求数据40ms延迟的问题，codis-proxy和redis都设置了TCP_NODELAY标志，但还是有40ms延迟，会不会是redis向proxy发送数据后，proxy延迟发送ack包，导致redis端拥塞窗口已满无法发送数据，只有等收到proxyack后才能继续发送。有人使用redis的时候在redis端设置TCP_QUICKACK标志吗
2019-06-13 18:20:28,667  Tab@拼多多 说: 
proxy到redis网络延迟是多少？
2019-06-13 18:21:34,682  杨力@喜马拉雅 说: 
局域网，延迟零点几个ms
2019-06-13 18:24:28,573  黄威@国美 说: 
你要不试着调大redis的outbuffer试试，你说的这个也有可能
2019-06-13 18:27:37,668  杨力@喜马拉雅 说: 
这个和redis的outbuffer关系不大吧，如果出现拥塞窗口沾满，调大redis的outbuffer应该也解决不了吧
2019-06-13 18:29:48,757  黄威@国美 说: 
其实你可以看下client里的outbuffer
2019-06-13 18:30:31,575  黄威@国美 说: 
而且，你这个现象并不是经常出现的吧，如果按照你分析的来看的话，调大点看看会不会缓解
2019-06-13 18:33:55,684  杨力@喜马拉雅 说: 
现在client里的outbuffer的是128KB
2019-06-13 18:34:16,312  白馨@陌陌 说: 
proxy处理太慢了吧
2019-06-13 18:34:25,783  杨力@喜马拉雅 说: 
最近才发现，这个40ms延迟问题
2019-06-13 18:34:37,840  白馨@陌陌 说: 
如果redis没有慢查询
2019-06-13 18:34:43,500  白馨@陌陌 说: 
那就跟tcp层面没有关系
2019-06-13 18:35:34,169  白馨@陌陌 说: 
应该是proxy 处理命令过慢
2019-06-13 18:35:36,288  杨力@喜马拉雅 说: 
redis上没有慢查询的
2019-06-13 18:36:10,479  白馨@陌陌 说: 
没有 慢查询 redis处理完命令 即使 有延迟ack ack也会随着处理完成的数据发过去
2019-06-13 18:36:34,451  白馨@陌陌 说: 
也就是说设置延迟ack也没有关系
2019-06-13 18:38:55,069  杨力@喜马拉雅 说: 
正常情况是这样，但是如果响应内容比较大一次发送不完就有问题了
2019-06-13 18:40:16,916  白馨@陌陌 说: 
一次发不完 ack也过去了
2019-06-13 18:41:01,433  白馨@陌陌 说: 
延时40ms的时候  单个返回大吗 还是返回也比较小
2019-06-13 18:41:10,448  杨力@喜马拉雅 说: 
客户端(proxy端)有延迟ack机制
2019-06-13 18:42:01,269  杨力@喜马拉雅 说: 
@白馨@陌陌 延时40ms的时候  单个返回大吗 还是返回也比较小
这个我再去验证一下
2019-06-13 20:44:17,419  鹏程@CMBC 说: 
欢迎新来的朋友~方便做个简单自我介绍，再把群名片改下名字@公司~然后看下群公告，谢谢！ @Tinker
