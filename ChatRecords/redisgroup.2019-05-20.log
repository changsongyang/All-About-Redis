2019-05-20 06:05:13,933  白馨@陌陌 说: 
# Close the connection after a client is idle for N seconds (0 to disable)
timeout 0
2019-05-20 06:05:26,057  白馨@陌陌 说: 
请问一下，这个时间一般大家设置多长？有没有什么说法
2019-05-20 06:07:03,244  刘乐＠多来点 说: 
这个东西不太好说，根据自己业务情况来定，设计到慢启动、连接过多的问题。
2019-05-20 06:08:05,283  白馨@陌陌 说: 
这个跟慢启动 没啥关系吧
2019-05-20 06:08:22,851  白馨@陌陌 说: 
不是 tcp_KEEPALIVE
2019-05-20 06:08:44,045  刘乐＠多来点 说: 
我说的慢启动是连接池的慢启动。
2019-05-20 06:08:44,361  刘乐＠多来点 说: 
不是tcp的
2019-05-20 06:09:52,351  xinxinbai@陌陌 说: 
连接池慢启动是什么意思啊
2019-05-20 06:13:18,051  刘乐＠多来点 说: 
跟业务有关系吧，比如你连接池设置的idle 连接比较少的话，突然的业务暴增，会同时创建很多新的连接，会导致业务的延时增加，我们之前有碰到过。
2019-05-20 06:13:48,192  刘乐＠多来点 说: 
根据自己的业务情况设置idle连接数和idle timeout。
2019-05-20 06:16:49,257  xinxinbai@陌陌 说: 
这是jedis做的事情
2019-05-20 06:17:40,002  刘乐＠多来点 说: 
奥，看错了。
2019-05-20 06:18:00,241  刘乐＠多来点 说: 
redis server的close连接也需要做。防止连接过多，还有垃圾连接。
2019-05-20 06:18:21,725  xinxinbai@陌陌 说: 
redis从两个角度做了这个事情
2019-05-20 06:18:28,952  xinxinbai@陌陌 说: 
不过我看从应用层
2019-05-20 06:18:36,545  xinxinbai@陌陌 说: 
timeout 0
2019-05-20 06:18:59,871  xinxinbai@陌陌 说: 
就是0 to disable
2019-05-20 06:19:10,907  xinxinbai@陌陌 说: 
一般线上都是这个设置 感觉没用上  所以问一下大家都设置多少
2019-05-20 06:19:41,854  麦霍键@腾讯 说: 
一般数据库不主动断开链接的，都交给应用层处理
2019-05-20 06:20:13,290  刘乐＠多来点 说: 
看怎么使用了，有没有滥用的情况，规范不规范，我们都有设置这个。
2019-05-20 06:20:40,933  刘乐＠多来点 说: 
之前redis实例使用没有规范，比较乱，实例公用，连接数过多。所以加了这个。
2019-05-20 06:20:57,970  刘乐＠多来点 说: 
如果是资源隔离的很好，使用方比较规范，不需要设置。
2019-05-20 06:21:21,654  xinxinbai@陌陌 说: 
一般数据库不主动断开链接的，都交给应用层处理？ 这个应用层是什么意思？
2019-05-20 06:22:09,901  刘乐＠多来点 说: 
你可以理解成jedis。
2019-05-20 06:22:16,826  麦霍键@腾讯 说: 
就是代码层了
2019-05-20 06:22:29,111  xinxinbai@陌陌 说: 
当然不能理解成jedis
2019-05-20 06:22:37,365  刘乐＠多来点 说: 
mysql默认都有这个设置，8小时
2019-05-20 06:22:48,637  xinxinbai@陌陌 说: 
不过应用的是否规范是很有道理的
2019-05-20 06:22:49,363  刘乐＠多来点 说: 
不能理解成jedis？业务怎么做？
2019-05-20 06:23:11,440  刘乐＠多来点 说: 
业务层的close实际只是把连接放回池子，并不是真正意义的close。
2019-05-20 06:23:15,912  xinxinbai@陌陌 说: 
不是一件事 我不扩展说这个话题
2019-05-20 06:24:48,567  xinxinbai@陌陌 说: 
@麦霍键@腾讯 mysql这么做的哦 redis倒是用了两种 tcp也设置了
2019-05-20 06:25:10,792  黄威@国美 说: 
这个我们一般设置为0，会定时kill掉超过1天的空闲的连接
2019-05-20 06:25:54,833  xinxinbai@陌陌 说: 
为啥不直接设置timeout 为一天
2019-05-20 06:31:44,219  黄威@国美 说: 
这个[捂脸]，下发的配置里是0也就没在改过了（因为懒，不是什么技术原因），redis-server的定时清除空闲时间过长client，和hz也有关系，如果设置的很频繁，会影响读写操作，因为底层存储client信息的就是一个链表，时间复杂度是o(n)
2019-05-20 06:33:36,081  黄威@国美 说: 
具体的部分在server.c下clientCron函数中
2019-05-20 06:36:26,486  黄威@国美 说: 
具体的函数调用链是server.c->clientCron()->clientsCronHandleTimeout()
2019-05-20 06:43:28,366  xinxinbai@陌陌 说: 
这个你设置不设置成0 ，它都会遍历链表
2019-05-20 06:46:36,715  黄威@国美 说: 
恩恩
2019-05-20 06:56:23,124  黄威@国美 说: 
请问一下，hz这个参数一般大家都设置多少？
2019-05-20 14:17:40,062  鹏程@CMBC 分享链接:
 #每日分享 「链接」 GitHub - RedisLabsModules/redisbloom: Bloom Filter...
https://t.zsxq.com/Fyv7A6q
